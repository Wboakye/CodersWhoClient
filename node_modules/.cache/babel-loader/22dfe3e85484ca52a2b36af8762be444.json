{"ast":null,"code":"import _objectSpread from \"/Users/william/Desktop/codersWho/coderswhoclient/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"/Users/william/Desktop/codersWho/coderswhoclient/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"/Users/william/Desktop/codersWho/coderswhoclient/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _jsxFileName = \"/Users/william/Desktop/codersWho/coderswhoclient/src/components/rerouting/OpenRoute.js\";\nimport React, { useEffect } from \"react\";\nimport store from \"../../redux/store\";\nimport axios from \"axios\";\nimport { setUser } from \"../../actions/user-actions\";\nimport { setLogged } from \"../../actions/auth-actions\";\n\nconst jwtDecode = require(\"jwt-decode\");\n\nconst host = \"http://localhost:3005\";\n\nconst OpenRoute = (_ref) => {\n  let Component = _ref.component,\n      isAuthenticated = _ref.isAuthenticated,\n      isLoading = _ref.isLoading,\n      rest = _objectWithoutProperties(_ref, [\"component\", \"isAuthenticated\", \"isLoading\"]);\n\n  const _React$useState = React.useState({\n    isAuthenticated: false,\n    isLoading: true\n  }),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        state = _React$useState2[0],\n        setState = _React$useState2[1];\n\n  const getUser = () => {\n    let token = sessionStorage.getItem(\"CWJWT\");\n    let decodedToken = jwtDecode(token);\n    axios({\n      url: host + \"/api/user/profile\",\n      method: \"POST\",\n      headers: {\n        \"auth-token\": token\n      },\n      data: {\n        userId: decodedToken._id\n      }\n    }).then(response => {\n      store.dispatch(setUser(response.data.body));\n    }).catch(function (error) {\n      alert(error);\n    });\n  };\n\n  useEffect((...rest) => {\n    //IF ALREADY AUTHENTICATED IN STORE, AUTHENTICATED\n    if (store.getState().auth.isLoginSuccess) {\n      setState({\n        isAuthenticated: true,\n        isLoading: false\n      });\n      return React.createElement(Component, Object.assign({}, rest, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 45\n        },\n        __self: this\n      }));\n    } else {\n      //IF JWT AVAILABLE, VALIDATE\n      if (sessionStorage.getItem(\"CWJWT\")) {\n        let token = sessionStorage.getItem(\"CWJWT\");\n        axios({\n          url: host + \"/api/user/authenticate\",\n          method: \"POST\",\n          headers: {\n            \"auth-token\": token\n          }\n        }).then(response => {\n          if (response.data.success === true) {\n            getUser();\n          }\n\n          setState(_objectSpread({}, state, {\n            isAuthenticated: response.data.success\n          }));\n          store.dispatch(setLogged(true));\n          setState(_objectSpread({}, state, {\n            isLoading: false\n          }));\n          return React.createElement(Component, Object.assign({}, rest, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 64\n            },\n            __self: this\n          }));\n        }).catch(function (error) {\n          alert(error);\n          setState({\n            isLoading: false\n          });\n          return React.createElement(Component, Object.assign({}, rest, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 69\n            },\n            __self: this\n          }));\n        });\n      } else {\n        setState(_objectSpread({}, state, {\n          isLoading: false\n        }));\n        return React.createElement(Component, Object.assign({}, rest, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 73\n          },\n          __self: this\n        }));\n      }\n    }\n  }, []);\n\n  if (state.isLoading) {}\n\n  if (!store.getState().auth.isLoginSuccess) {\n    return React.createElement(Component, Object.assign({}, rest, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81\n      },\n      __self: this\n    }));\n  }\n\n  return React.createElement(Component, Object.assign({}, rest, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83\n    },\n    __self: this\n  }));\n};\n\nexport { OpenRoute };","map":{"version":3,"sources":["/Users/william/Desktop/codersWho/coderswhoclient/src/components/rerouting/OpenRoute.js"],"names":["React","useEffect","store","axios","setUser","setLogged","jwtDecode","require","host","OpenRoute","Component","component","isAuthenticated","isLoading","rest","useState","state","setState","getUser","token","sessionStorage","getItem","decodedToken","url","method","headers","data","userId","_id","then","response","dispatch","body","catch","error","alert","getState","auth","isLoginSuccess","success"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\nimport store from \"../../redux/store\";\nimport axios from \"axios\";\nimport { setUser } from \"../../actions/user-actions\";\nimport { setLogged } from \"../../actions/auth-actions\";\n\nconst jwtDecode = require(\"jwt-decode\");\n\nconst host = \"http://localhost:3005\";\n\nconst OpenRoute = ({\n  component: Component,\n  isAuthenticated,\n  isLoading,\n  ...rest\n}) => {\n  const [state, setState] = React.useState({\n    isAuthenticated: false,\n    isLoading: true\n  });\n\n  const getUser = () => {\n    let token = sessionStorage.getItem(\"CWJWT\");\n    let decodedToken = jwtDecode(token);\n    axios({\n      url: host + \"/api/user/profile\",\n      method: \"POST\",\n      headers: {\n        \"auth-token\": token\n      },\n      data: { userId: decodedToken._id }\n    })\n      .then(response => {\n        store.dispatch(setUser(response.data.body));\n      })\n      .catch(function(error) {\n        alert(error);\n      });\n  };\n\n  useEffect((...rest) => {\n    //IF ALREADY AUTHENTICATED IN STORE, AUTHENTICATED\n    if (store.getState().auth.isLoginSuccess) {\n      setState({ isAuthenticated: true, isLoading: false });\n      return <Component {...rest} />;\n    } else {\n      //IF JWT AVAILABLE, VALIDATE\n      if (sessionStorage.getItem(\"CWJWT\")) {\n        let token = sessionStorage.getItem(\"CWJWT\");\n        axios({\n          url: host + \"/api/user/authenticate\",\n          method: \"POST\",\n          headers: {\n            \"auth-token\": token\n          }\n        })\n          .then(response => {\n            if (response.data.success === true) {\n              getUser();\n            }\n            setState({ ...state, isAuthenticated: response.data.success });\n            store.dispatch(setLogged(true));\n            setState({ ...state, isLoading: false });\n            return <Component {...rest} />;\n          })\n          .catch(function(error) {\n            alert(error);\n            setState({ isLoading: false });\n            return <Component {...rest} />;\n          });\n      } else {\n        setState({ ...state, isLoading: false });\n        return <Component {...rest} />;\n      }\n    }\n  }, []);\n\n  if (state.isLoading) {\n  }\n  if (!store.getState().auth.isLoginSuccess) {\n    return <Component {...rest} />;\n  }\n  return <Component {...rest} />;\n};\n\nexport { OpenRoute };\n"]},"metadata":{},"sourceType":"module"}